@model Connect4m_Web.Models.Attendenceproperites.detailsattendance


@{
    ViewData["Title"] = "Attendance_Details";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<!DOCTYPE html>
<html>
<head>
    <link href="~/css/maps/Summary.css" rel="stylesheet" />
</head>
<body>
    <div class="flex-grow-1 container-p-y container-fluid">
        <h4 class="py-3 mb-4"><span class="text-muted fw-light">Attendance /</span>ATTENDANCE DETAILS </h4>
        <div class="row mb-2">
            <div class="col-md-12 col-lg-12 mb-3">
                <div class="card mb-4">
                    <div class="card-header d-flex align-items-center justify-content-between">
                        <h5 class="mb-0">
                            ATTENDANCE DETAILS
                        </h5> <small class="text-muted float-end">* INDICATES MANDATORY FIELD</small>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col">
                                <form class="form" id="Attendancedetailsform">
                                    <div class="row mb-3">
                                        <label asp-for="StartDate" class="control-label col-sm-4 col-form-label text-end required space">StartDate</label>
                                        <div class="col-sm-4">
                                            <input type="date" id="StartDateid" asp-for="StartDate" class="form-control">
                                            <span asp-validation-for="StartDate" class="text-danger"></span>
                                        </div>
                                    </div>




                                    @*<div class="card">
                                    <div class="card-header pb-0">
                                        <h6><span>ATTENDANCE DETAILS</span></h6>*@


                                    <div id="Admin_View_ID">
                                        <!--<div style="font-size: 12px;">
                                    <label id="validation2" style="color:red"></label><br />
                                    <label id="validation1" style="color:red"></label>
                                    <span class="validation" asp-validation-for="StartDate"></span>
                                    <span class="validation" asp-validation-for="EndDate"></span>
                                    <input type="hidden" value="" readonly id="S_Userid_Value" />
                                    <input type="hidden" value="" readonly id="InstanceId_Value" />-->
                                        @*<input type="hidden" value="@ViewBag.InstanceId" id="InstanceTxt_Id" />*@
                                        <!--</div>-->
                                        @*<div class="card">
                                        <div class="card-body">
                                            <div class="default-according style-1" id="accordionoc">
                                                <div class="card">
                                                    <div class="card-header bg-primary">
                                                        <h5 class="mb-0">
                                                            <button class="collapsed btn btn-link text-white" data-bs-toggle="collapse" data-bs-target="#collapseicon1" aria-expanded="true" aria-controls="collapse11" style="width: 99%;">ATTENDANCE DETAILS</button>
                                                        </h5>
                                                    </div>*@
                                        @*<div class="collapse show" id="collapseicon1" aria-labelledby="collapseicon1" data-bs-parent="#accordionoc1" style="">
                                        <div class="card-body">
                                            <form class="form" id="myForm">
                                                <div asp-validation-summary="All" class="text-danger"></div>
                                                <div class="form-group row">
                                                    <div class="row">
                                                        <div class="col-3"></div>
                                                        <div class="form-group col-2">
                                                            <label class="form-label required space">StartDate </label>
                                                        </div>
                                                        <div class="form-group col-4">
                                                            <input type="date" asp-for="StartDate" id="StartDateid" class="form-control">
                                                        </div>
                                                        <div class="col-3"></div>*@


                                        <div class="row mb-3">
                                            <label asp-for=EndDate class="control-label col-sm-4 col-form-label text-end required space">EndDate </label>
                                            <div class="col-sm-4">
                                                <input type="date" id="EndDateid" asp-for="EndDate" class="form-control">
                                                <span asp-validation-for="StartDate" class="text-danger"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <label asp-for="InstanceClassificationId" class="control-label col-sm-4 col-form-label text-end required space">Department</label>
                                            <div class="col-sm-4">
                                                <div class="position-relative">
                                                    <select class="select2 form-select select2-hidden-accessible" id="Ddldepartment" asp-for="InstanceClassificationId">
                                                    </select>
                                                    <span asp-validation-for="InstanceClassificationId" class="text-danger"></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <label asp-for="InstanceSubclassificaitionId" class="control-label col-sm-4 col-form-label text-end required space">Class</label>
                                            <div class="col-sm-4">
                                                <div class="position-relative">
                                                    <select class="select2 form-select select2-hidden-accessible" id="DdlSubClass" asp-for="InstanceSubclassificaitionId">
                                                    </select>
                                                    <span asp-validation-for="InstanceSubclassificaitionId" class="text-danger"></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <label asp-for="Studentuserid" class="control-label col-sm-4 col-form-label text-end required space">Student</label>
                                            <div class="col-sm-4">
                                                <div class="position-relative">
                                                    <select class="select2 form-select select2-hidden-accessible" id="Studentnamesddl" asp-for="Studentuserid">
                                                    </select>
                                                    <span asp-validation-for="Studentuserid" class="text-danger"></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <label asp-for="SubjectSlotID" class="control-label col-sm-4 col-form-label text-end required space">Slots </label>
                                            <div class="col-sm-4">
                                                <div class="position-relative">
                                                    <select multiple class="select2 form-select select2-hidden-accessible" id="Slotddl" asp-for="SubjectSlotID">
                                                    </select>
                                                    <span asp-validation-for="SubjectSlotID" class="text-danger"></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <label asp-for="bFlagForDisplay" class="control-label col-sm-4 col-form-label text-end required space">Display only for </label>
                                            <div class="col-sm-4">
                                                <div class="col-1 form-check">
                                                    <input type="radio" asp-for="bFlagForDisplay" value="1" name="bFlagForDisplay" class="form-check-input" id="defaultRadio1">
                                                    <label class="form-check-label" for="defaultRadio1">Present</label>
                                                </div>
                                                <div class="col-1 form-check">
                                                    <input type="radio" asp-for="bFlagForDisplay" value="0" name="bFlagForDisplay" class="form-check-input" id="defaultRadio2">
                                                    <label class="form-check-label" for="defaultRadio2">Absent</label>
                                                </div>
                                                <div class="col-1 form-check">
                                                    <input type="radio" asp-for="bFlagForDisplay" value="2" name="bFlagForDisplay" class="form-check-input" id="defaultRadio3">
                                                    <label class="form-check-label" for="defaultRadio3">Both</label>
                                                </div>
                                                <span asp-validation-for="bFlagForDisplay" id="bFlagForDisplayvalidationmessages" class="text-danger"></span>
                                            </div>
                                        </div>
                                        <div class="row justify-content text-center">
                                            <div class="col-sm-12">
                                                <button type="reset" class="btn btn-warning waves-effect waves-light" onclick="CommonClearFunction('Summerydetails')" id="BtnClear">Clear</button>
                                                <button type="submit" class="btn btn-success waves-effect waves-light" id="Get_atd_btn">Search </button>
                                            </div>
                                        </div>


                                        @*<div class="row mb-3">
                                        <label asp-for="ClassificationName" class="control-label col-sm-4 col-form-label text-end required space">Department </label>

                                        @if (ViewBag.TClassification != null)
                                        {
                                        <div class="form-group col-4" id="DCFN10">
                                        @Html.DropDownListFor(Model => Model.ClassificationName, new SelectList(ViewBag.TClassification, "Value", "Text"), "--Select--", new { @id = "CFNID1", @class = "form-select" })
                                        </div>
                                        }
                                        </div>*@
                                        @*<div class="col-3"></div>
                                        <div class="col-3"></div>
                                        <div class="form-group col-2">
                                            <label asp-for="SubClassificationName" class="form-label required space">Class </label>
                                        </div>
                                        <div class="form-group col-4" id="SCFNID2">
                                            @Html.DropDownListFor(Model => Model.SubClassificationName, new SelectList(string.Empty, "Value", "Text"), "--Select--", new { @id = "SCFNID1", @class = "form-select" })
                                        </div>*@
                                        @*<div class="col-3"></div>

                                        <div class="col-3"></div>
                                        <div class="form-group col-2">
                                            <label class="form-label required space">Student Name </label>
                                        </div>
                                        <div class="form-group col-4" id="StudentNames">
                                            @Html.DropDownListFor(Model => Model.FirstName, new SelectList(string.Empty, "Value", "Text"), "--Select--", new { @id = "SN1", @class = "@*DropTxtbox form-select" })*@
                                        @*  <span asp-validation-for="FirstName" class="text-danger"></span>
                                        </div>
                                        <div class="col-3"></div>
                                        <div class="col-3"></div>*@

                                        @*<div class="form-group col-2">
                                            <label asp-for="SubjectName" class="form-label required space">Slot </label>
                                        </div>
                                        <div class="form-group col-4">
                                            @Html.ListBoxFor(Model => Model.SubjectName, new SelectList(string.Empty, "Value", "Text"), new { @id = "Subjects", @class = "Lstbox" })
                                        </div>
                                        <div class="col-3"></div>*@
                                        @*<div class="col-3"></div>
                                        <div class="form-group col-2">
                                            <label class="form-label  space">Display only for :</label>
                                        </div>
                                        <div class="form-group col-4 radio radio-primary">
                                            <input type="radio" asp-for="bFlagForDisplay" value="1" class="ATD" id="radioinline1" name="radio1" style=" margin: 0px 0px 0px 8px;">
                                            <label class="mb-0" for="radioinline1">Present</label>
                                            <input type="radio" asp-for="bFlagForDisplay" value="0" class="ATD" id="radioinline2" name="radio1" style=" margin: 0px 0px 0px 8px;">
                                            <label class="mb-0" for="radioinline2">Absent</label>
                                            <input type="radio" asp-for="bFlagForDisplay" value="2" class="ATD" id="radioinline3" name="radio1" style=" margin: 0px 0px 0px 8px;">
                                            <label class="mb-0" for="radioinline3">Both</label>
                                        </div>*@
                                        @*<div class="col-3"></div>
                                        <div class="col-3"></div>
                                        <div class="form-group col-2"></div>
                                        <div class="form-group col-4">
                                            <button class="btn btn-pill btn-outline-warning btn-air-warning" type="reset">Clear</button>
                                            <input type="button" id="Get_atd_btn" class="btn btn-pill btn-outline-success btn-air-success" value="Search">
                                        </div>
                                        <div class="col-3"></div>*@
                                    </div>
                                    @*</div>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>*@
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="User_Attendance_Tbl">

        </div>
    </div>

   



    @*</div>
        </div>*@  
</body>
</html>


<script src="~/lib/jquery/dist/jquery.js"></script>
<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/ui/1.13.0/jquery-ui.min.js"></script>
<script src="~/js/Attendancedetails.js"></script>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}


<!--Student Javascript code start-->
<script>
    window.onload = function () {
        showDivBasedOnValue();
    };

    function showDivBasedOnValue() {
        debugger;
        var studentUserId = document.getElementById("S_Userid_Value").value;
        var instanceId = document.getElementById("InstanceId_Value").value;
        var Admin_View = document.getElementById("Admin_View_ID");
        var Student_View = document.getElementById("Student_View_ID");

        if (studentUserId && studentUserId.trim() !== "" && instanceId && instanceId.trim() !== "") {
            // Both studentUserId and instanceId have values
            Admin_View.style.display = "none";
            Student_View.style.display = "block";
        } else {
            // Either studentUserId or instanceId is missing
            Admin_View.style.display = "block";
            Student_View.style.display = "none";
        }
    }

    //window.onload = function () {
    //    showDivBasedOnValue
    //};
    //debugger;
    //function showDivBasedOnValue() {
    //    debugger;
    //    var studentUserId = document.getElementById("S_Userid_Value").value;
    //    var instanceId = document.getElementById("InstanceId_Value").value;
    //    var Admin_View = document.getElementById("Admin_View_ID");
    //    var Student_View = document.getElementById("Student_View_ID");


    //    if (studentUserId && studentUserId.trim() !== "" && instanceId && instanceId.trim() !== "") {
    //        // Both studentUserId and instanceId have values
    //        Admin_View.style.display = "none";
    //        Student_View.style.display = "block";
    //    } else if (instanceId && instanceId.trim() !== "") {
    //        // Only instanceId has a value
    //        Admin_View.style.display = "block";
    //        Student_View.style.display = "none";
    //    } else {
    //        // Neither value is provided
    //        Admin_View.style.display = "none";
    //        Student_View.style.display = "none";
    //    }
    //}

    document.addEventListener("DOMContentLoaded", function () {
        ShowFields(); // Call showData() function on page load
    });
    function ShowFields() {
        var dateWiseDiv = document.getElementById("DateWise_Id_fields");
        var monthWiseDiv = document.getElementById("MonthWise_Id_fields");
        var dateRadioButton = document.getElementById("radioButton1");

        if (dateRadioButton.checked) {
            dateWiseDiv.style.display = "block";
            monthWiseDiv.style.display = "none";
        } else {
            dateWiseDiv.style.display = "none";
            monthWiseDiv.style.display = "block";
        }
    }




</script>
<script>
    $("#Student_Details_Btn").click(fun2501);
    /* $("#Student_Details_Btn").click(fun2501);*/
    function fun2501() {
        debugger;

        var St_Date = $("#St_details_Stdt").val();
        var En_Date = $("#St_details_Etdt").val();
        var InstanceSubjectId = $("#Student_SlotID").val();
        var today = new Date();
        if (St_Date > today) {
            $("#validation5").text("End Date can not be greater than today.");
        }
        else if (St_Date > En_Date) {

            $("#validation5").text("Start date cannot be greater than end date.");

        } else if (St_Date === '' && En_Date === '') {

            $("#validation3").text("Following fields have invalid data :");
            $("#validation5").text("Please Select Startdate and Enddate");

        } else if (St_Date == '') {

            $("#validation3").text("Following fields have invalid data :");
            $("#validation5").text("Please Select Startdate");

        } else if (En_Date == '') {

            $("#validation3").text("Following fields have invalid data :");
            $("#validation5").text("Please Select Enddate");

        } else if (InstanceSubjectId == '') {

            $("#validation3").text("Following fields have invalid data :");
            $("#validation4").text("Slot");

        } else {

            $("#validation3,#validation4,#validation5").text('');
            $(this).removeClass('validation3', 'validation4', 'validation5')

            debugger;


            var St_details_formdata = $("#date_Wise_Attendance_Details").serialize();
            $.ajax({

                url: "/Attendance/Attd_det_by_St_Lg",
                type: "GET",
                data: St_details_formdata,
                success: fun2150
            });
            function fun2150(resptbl) {
                debugger;
                /* alert("Sreee");*/
                $("#Student_Attendance_Details_Tbl").html(resptbl);
            }
        }
    }
</script>

<!--Student Javascript code End-->
<!--Admin Javascript Code start-->
<script>
    $("#DCFN10").change(fun101);
    function fun101() {
        /*debugger;*/
        var value = $('#CFNID1').val();

        $.ajax({
            url: "/Attendance/Get_SubClassificationNames_ByInstanceClassifications?InstanceClassificationId=" + value,
            type: "GET",
            success: fun1011
        });
        function fun1011(response) {
            /*debugger;*/
            $("#SCFNID1").html(response);
        }

    }

    $("#SCFNID2").change(fun1021);
    function fun1021() {
        debugger;

        var InstanceClassificationId = $('#CFNID1').val();
        var InstanceSubClassificationId = $('#SCFNID1').val();
        //alert(InstanceClassificationId);
        //alert(InstanceSubClassificationId);
        $.ajax({
            url: "/Attendance/SlotidBy_Student_Names?InstanceClassificationId=" + InstanceClassificationId + "&InstanceSubClassificationId=" + InstanceSubClassificationId,
            type: "GET",
            success: fun10121
        });
        function fun10121(response) {
            debugger;
            $("#SN1").html(response);
        }
    }

    $("#StudentNames").change(fun1013);
    function fun1013() {
        debugger;
        var UserID = $('#SN1').val();

        /*alert(value);*/
        $.ajax({
            url: "/Attendance/Slot_by_UserName?UserID=" + UserID,
            type: "GET",
            success: fun10113
        });
        function fun10113(response) {
            debugger;
            $("#Subjects").html(response);
        }

    }
</script>

<script>
    //Date Function Javascript Code start
    var date = new Date();
    var day = date.getDate();
    var month = date.getMonth() + 1;
    var year = date.getFullYear();

    if (month < 10) month = "0" + month;
    if (day < 10) day = "0" + day;

    var today = year + "-" + month + "-" + day;

    document.getElementById("StartDateid").value = today;
    document.getElementById("EndDateid").value = today;


</script>

<script>

    $("#Get_atd_btn").click(fun0132); /*fun013*/
    function fun013() {
        debugger;

        var validation1 = $("#validation1");
        var validation2 = $("#validation2");

        var InstClassificationId = $("#CFNID1").val();
        var InstSubClassificationId = $("#SCFNID1").val();
        var UserID = $('#SN1').val();
        var SubSlotID = $("#Subjects").val();

        var SDate = $('#StartDateid').val();
        var parts = SDate.split('-');
        var formattedDate = parts[0] + '-' + parts[1] + '-' + parts[2] + ' 00:00:00';
        console.log(formattedDate); // Output: '29-09-2023 00:00:00'
        var StartDate = formattedDate;


        var EDate = $("#EndDateid").val();
        var ENparts = EDate.split('-');
        var FormteENDate = ENparts[0] + '-' + ENparts[1] + '-' + ENparts[2] + ' 00:00:00';
        console.log(FormteENDate); // Output: '29-09-2023 00:00:00'
        var EndDate = FormteENDate;

        //var Instanceid = $("#InstanceTxt_Id").val();
        var bFlagForDisplay = $("input[class='ATD']:checked").val();

        validation1.text("");
        validation2.text("");


        function displayInvalidDataMessage(fieldName) {
            validation2.text("Following fields have invalid data:");
            validation1.text(fieldName);
        }

        debugger;

        if (StartDate > EndDate) {
            validation2.text("Following fields have invalid data:");
            validation1.text("Start date can not be greater than end date.");

        } else if (InstClassificationId === "") {
            validation2.text("Following fields have invalid data:");
            displayInvalidDataMessage("Department");

        } else if (InstSubClassificationId === "") {
            validation2.text("Following fields have invalid data:");
            displayInvalidDataMessage("Class");

        } else if (UserID === "") {
            validation2.text("Following fields have invalid data:");
            displayInvalidDataMessage("Student Name");

        } else if (SubSlotID == '') {
            validation2.text("Following fields have invalid data:");
            displayInvalidDataMessage("Slot");

        } else if (typeof bFlagForDisplay === "undefined") {
            validation2.text("Following fields have invalid data:");
            displayInvalidDataMessage("Display only for");

        } else {

            $("#validation1,#validation2").text('');
            $(this).removeClass('validation1', 'validation2')



            var FormData = {
                StartDate: StartDate,
                EndDate: EndDate,
                FirstName: UserID,
                SlotSubjectsNames: SubSlotID,
                bFlagForDisplay: bFlagForDisplay

            }
            var serializedData = $.param(FormData);

            $.ajax({
                //url: "/Attendance/Get_Attendance_Details_Tbl",
                url: "/Attendance/Get_Attendance_Details_Tbl?StartDate=" + StartDate + "&EndDate=" + EndDate + "&UserID=" + UserID + "&SlotSubjectsNames=" + SubSlotID + "&bFlagForDisplay=" + bFlagForDisplay,
                type: "GET",
                success: function (response) {
                    $('#User_Attendance_Tbl').html(response);
                }

                //success: fun0125
            });



            //function fun0125(resp) {
            //    debugger;

            //    $("#User_Attendance_Tbl").html(resp);
            //}
        }
    }


    $("button[type='reset']").click(function () {

        $("#CFNID1").val("");
        $("#SCFNID1").val("");
        $('#SN1').val("");
        $("#Subjects").val("");
        $("#User_Attendance_Tbl").html("");
    });

</script>
<!--Admin Javascript Code End-->
