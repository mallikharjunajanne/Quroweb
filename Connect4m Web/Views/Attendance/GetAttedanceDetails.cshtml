@model IEnumerable<Connect4m_Web.Models.Attendenceproperites.PostAttendance>
@{
    Layout = null;
}


@if (ViewBag.ModelMessage == "1")
{
    <div style=" margin-top: -43%; position: absolute; color: red; font-size: 12px;">@ViewBag.E_Message</div>
}
else
{
    <!DOCTYPE html>
    <html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <style>
            body {
                font-family: Arial, Helvetica, sans-serif;
            }

            /* The Modal (background) */
            .modal {
                display: none;
                z-index: 1;
                padding-top: 93px;
                background-color: rgb(0,0,0,0);
            }

            /* Modal Content */
            .modal-content {
                background-color: pink;
                border: 0px solid #888;
                width: 26%;
                margin-left: 38%;
                font-weight: 800;
                height: auto;
            }

            /* The Close Button */
            .close {
                color: #AAABE7;
                font-weight: bolder;
                float: right;
                font-size: 28px;
                font-weight: bold;
                text-align: right;
                cursor: pointer;
            }

            .Dropdown {
                border-right: #b4b4b4 1px solid;
                border-top: #b4b4b4 1px solid;
                font-weight: normal;
                font-size: 10px;
                border-left: #b4b4b4 1px solid;
                color: #000000;
                border-bottom: #b4b4b4 1px solid;
                font-family: Verdana, Arial, Helvetica, sans-serif;
            }

            .box {
                width: 191px;
                height: 26px;
                font-size: 11px;
                color: brown;
                background-color: azure;
                border-radius: 15px
            }

            .Box_Btn {
                width: 89px;
                height: 20px;
                font-size: 10px;
                color: brown;
                background-color: aliceblue;
                border-radius: 9px;
            }

            .span_text {
                font-size: 10pt;
                font-weight: bold;
                font-style: normal;
            }
        </style>
    </head>
    <body>



        <div id="myModal">

            <div id="CH-Comments" style=" text-align: center; position: absolute; top: 75%;">

            </div>
        </div>
        <div style="width: 100%;">
            <div class="card-body">
                <div class="default-according style-1" id="accordionoc">
                    <div class="card">
                        <div class="card-header bg-primary">
                            <h5 class="mb-0">
                                <button class="HeaderBtn collapsed btn btn-link text-white" data-bs-toggle="collapse" data-bs-target="#collapseicon2" aria-expanded="true" aria-controls="collapse11" style="width: 99%;">NOTE</button>
                            </h5>
                        </div>
                        <div class="collapse show" id="collapseicon2" aria-labelledby="collapseicon2" data-bs-parent="#accordionoc2">
                            <div class="card-body">
                                <div class="row">
                                    <div class="row">
                                        <div class="col-6"><span class="span_text" style="color:green;">Green Date--Indicates attendance already posted.</span></div>
                                        <div class="col-6"><span class="span_text"> <img src="~/assets/images/tick.png" alt="Image to indicate Send Sms is true." style="height:16px;width:16px;border-width:0px;">-- Indicates Send Sms is true.</span></div>
                                        <div class="col-6"><span class="span_text" style="color:red;">Red Date--Indicates attendance not yet posted (if any withdrawal applied students are there in a class).</span></div>
                                        <div class="col-6">
                                            <span class="span_text">
                                                <img src="~/assets/images/cross.png" />-- Indicates Send Sms is false.
                                            </span>
                                        </div>
                                        <div class="col-6">
                                            <span class="span_text">
                                                <img src="~/assets/images/AuditIcon.png" style="height: 13px;" /> --Indicates Attendance modified.
                                            </span>
                                        </div>
                                        <div class="col-6">
                                            <span class="span_text">
                                                <img src="~/assets/images/exclaim.png" style="height: 17px;" />--Indicates Parent Data is not available.
                                            </span>
                                        </div>
                                        <div class="col-6">
                                            <span class="span_text">
                                                <img src="~/assets/images/details_open.png" />    --To post Special Attendance click on this icon, a dropdown will display.
                                            </span>
                                        </div>
                                        <div class="col-6">
                                            <span class="span_text" style="color:red;">Red Color --Student Name with Red colour indicates that attendance posting date is greater than student last date of attendance.</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div>
            <span id="MailS_ErrorMsg" style="color: red; font-size: 14px;"></span>
        </div>
        <div class="checkbox checkbox-solid-danger " style=" font-size: 13px; margin-left: 11px; ">

            <input id="solid4" type="checkbox" class="SMS_Stu_Checkboxid">
            <label for="solid4">Sms To Student</label>
            &nbsp;&nbsp;
            <input id="solid5" type="checkbox" class="SMS_Par_Checkboxid" />
            <label for="solid5">Sms To Parent</label>
            &nbsp;&nbsp;
            <input id="solid6" type="checkbox" class="Email_Stu_Checkboxid" />
            <label for="solid6">Send Email To Students</label>
            &nbsp;&nbsp;
            <input id="solid7" type="checkbox" class="Email_Par_Checkboxid" />
            <label for="solid7">Send Email To Parents</label>

        </div>
        <div style=" margin-left: 1.75%;">
            <input type="checkbox" id="selectAll" class="checkbox-solid-success" />Check All
        </div>
        <div class="card-body">
            <div class="default-according style-1" id="accordionoc">
                <div class="card">
                    <div class="card-header bg-primary">
                        <h5 class="mb-0">
                            <button class="HeaderBtn collapsed btn btn-link text-white" data-bs-toggle="collapse" data-bs-target="#collapseicon2" aria-expanded="true" aria-controls="collapse11" style="width: 99%;">YOUR SEARCH RESULTED <span class="AttendanceCount"></span> RECORDS.</button>
                        </h5>
                    </div>

                    <div class="collapse show" id="collapseicon2" aria-labelledby="collapseicon2" data-bs-parent="#accordionoc2">
                        <div class="card-body">
                            <div class="table-responsive" id="Post_Atd_Tbl">
                                <table class="table table-bordered"  id="TableData">
                                    <thead>
                                        <tr>
                                            <th colspan="6" style="color: black; font-size: 84%;  ">Department Class :<b>@ViewBag.Departementclass</b></th>
                                        </tr>
                                        <tr class="border-bottom-primary">
                                            <th scope="col" style="font-size: 89%; ">SNO</th>
                                            <th scope="col" style="font-size: 89%; ">Name</th>
                                            <th scope="col" style="font-size: 89%; ">Reg.No</th>
                                            <th scope="col" style="font-size: 89%; ">Student Sms Status</th>
                                            <th scope="col" style="font-size: 89%; ">Parent Sms Status</th>
                                            <th scope="col" style="font-size: 80%; " id="A_PostingDate"><input type="hidden" readonly class="A_PostingDate" value="@ViewBag.Date"> @ViewBag.DateFormate</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @{int index = 1; int i = 2;}


                                        @foreach (var item in Model)
                                        {

                                            <tr class="border-bottom-secondary">

                                                <td scope="row"> @index</td>
                                                <td hidden>@item.UserId</td>
                                                <td hidden>@item.ParentPhNo</td>

                                                @if (item.LastDateofAttendance == "")
                                                {
                                                    <td style="color:black;font-weight:200;"> @item.FirstName</td>
                                                }
                                                else
                                                {
                                                    <td style="color:red;">@item.FirstName</td>
                                                }


                                                <td align="center" width="32px">@*@item.AdmissionNumber*@    @item.InstanceUserCode</td>
                                                @if (item.StudentSMS == "True")
                                                {
                                                    <td style="text-align: center;"><img src="~/assets/images/tick.png" alt="Trulli" width="26" height="28" style="width: 26px;height: 28px;" /></td>
                                                }
                                                else
                                                {
                                                    <td style="text-align: center;"><img src="~/assets/images/cancle-tick.jpg" width="50" height="33" style="width: 26px;height: 28px;" /></td>
                                                }
                                                @if (item.ParentSMS == "True")
                                                {
                                                    <td style="text-align: center;"><img src="~/assets/images/tick.png" alt="Trulli" width="50" height="33" style="width: 26px;height: 28px;" /></td>
                                                }
                                                else
                                                {
                                                    <td style="text-align: center;" title="@item.ParentPhNo"><img src="~/assets/images/cancle-tick.jpg" width="50" height="33" style="width: 30px; height: 31px;" /></td>
                                                }

                                                @if (item.LastDateofAttendance == "")
                                                {
                                                    <td align="center">
                                                        @if (item.column1 == "1")
                                                        {
                                                            <input type="checkbox" class="checkbox" id="@i" title="@item.FirstName" name="@item.UserId" checked="checked" />

                                                            <div class="eye-icon">
                                                                <img src="~/assets/images/details_open.png" id="Leave_Img_Comment" />
                                                            </div>

                                                            <div class="content">
                                                                <div class="dropdown">
                                                                    <select id="ddData" asp-items="@( new SelectList(""))" class="box form-select input-air-primary digits" style="width: 96%;">
                                                                        <option>--Select--</option>
                                                                        @foreach (var items in ViewBag.AttendanceLeave_Types)
                                                                        {
                                                                            if (@items.Value == item.column1.ToString())
                                                                            {
                                                                                <option value="@items.Value" selected>@items.Text</option>
                                                                            }
                                                                            else
                                                                            {
                                                                                <option value="@items.Value">@items.Text</option>
                                                                            }
                                                                        }
                                                                    </select>
                                                                    @*@Html.DropDownListFor(modelItem => item.AttendanceTypeId, new SelectList(ViewBag.AttendanceLeave_Types, "Value", "Text", item.AttendanceTypeId), "--Select--", new { @id = "ddData", @class = "Dropdown form-select input-air-primary digits", @style = "width: 96%;" })*@
                                                                </div>

                                                                <div id="CMT_BTN">
                                                                    <input type="button" class="add-comments-btn  Box_Btn" value="Add comments" style="display: none;" title="@item.FirstName" data-toggle="modal" data-target="#commentModal" />
                                                                </div>
                                                                <div class="popup arrow-top">
                                                                    <div class="popup-wrapper">
                                                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                            <span aria-hidden="true">×</span>
                                                                        </button>
                                                                        <div style="color: black; font-size: 14px;">
                                                                            Enter Comments to the date <p style="margin: 0; display: inline;" id="popuprowDate"></p> for student '<p style="margin: 0; display: inline;" id="popupContent"></p>'
                                                                        </div>
                                                                        <textarea id="commentTextArea" class="CommentsArea" required>@item.SplAttenanceComments1</textarea>
                                                                        <br />
                                                                        <input type="button" value="Ok" class="submit-comments-btn" style="background-color: wheat; border-radius: 31%;" />

                                                                    </div>
                                                                </div>
                                                            </div>
                                                        }
                                                        else
                                                        {
                                                            <input type="checkbox" class="checkbox" id="@i" title="@item.FirstName" name="@item.UserId" />

                                                            <div class="eye-icon">
                                                                <img src="~/assets/images/details_open.png" id="Leave_Img_Comment" />
                                                            </div>

                                                            <div class="content">
                                                                <div class="dropdown">
                                                                    <select id="ddData" asp-items="@( new SelectList(""))" class="box form-select input-air-primary digits">
                                                                        <option>--Select--</option>
                                                                        @foreach (var items in ViewBag.AttendanceLeave_Types)
                                                                        {
                                                                            if (@items.Value == item.column1.ToString())
                                                                            {
                                                                                <option value="@items.Value" selected>@items.Text</option>
                                                                            }
                                                                            else
                                                                            {
                                                                                <option value="@items.Value">@items.Text</option>
                                                                            }
                                                                        }
                                                                    </select>
                                                                    @*@Html.DropDownListFor(modelItem => item.AttendanceTypeId, new SelectList(ViewBag.AttendanceLeave_Types, "Value", "Text", item.AttendanceTypeId), "--Select--", new { @id = "ddData", @class = "Dropdown form-select input-air-primary digits", @style = "width: 96%;" })*@
                                                                </div>

                                                                <div id="CMT_BTN">
                                                                    <input type="button" class="add-comments-btn  Box_Btn" value="Add comments" style="display: none;" title="@item.FirstName" data-toggle="modal" data-target="#commentModal" />
                                                                </div>
                                                                <div class="popup arrow-top">
                                                                    <div class="popup-wrapper">
                                                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                            <span aria-hidden="true">×</span>
                                                                        </button>
                                                                        <div style="color: black; font-size: 14px;">
                                                                            Enter Comments to the date <p style="margin: 0; display: inline;" id="popuprowDate"></p> for student '<p style="margin: 0; display: inline;" id="popupContent"></p>'
                                                                        </div>
                                                                        <textarea id="commentTextArea" class="CommentsArea" required>@item.SplAttenanceComments1</textarea>
                                                                        <br />
                                                                        <input type="button" value="Ok" class="submit-comments-btn" style="background-color: wheat; border-radius: 31%;" />

                                                                    </div>
                                                                </div>
                                                            </div>
                                                            @*<script>
                                                                $(document).ready(function () {
                                                                    if ('@item.SplAttenanceComments1' != '') {

                                                                        $('.content').show();
                                                                        $('.submit-comments-btn').text('Edit Comments');

                                                                    }
                                                                });
                                                            </script>*@
                                                        }
                                                    </td>
                                                }
                                                else
                                                {
                                                    <td align="center">
                                                        <input type="checkbox" class="checkbox" id="@i" title="@item.FirstName" name="@item.UserId" disabled="disabled" />
                                                    </td>
                                                }


                                                <td hidden id="Stu_Email">@item.StudEmail</td>
                                                <td hidden id="Pa_Email">@item.ParentEmail</td>
                                                <td hidden id="AttendanceId1_Color_Chainge">@item.AttendanceId1</td>
                                            </tr>
                                            index++;
                                            i++;
                                        }

                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <form>
            <div class="col-sm-9" style=" text-align: center; margin-left: 14%;">
                <button class="btn btn-pill btn-light active txt-dark" type="submit" style="width: 18%; text-align: center;">Preview</button>
                <button class="btn btn-pill btn-success active" type="button" id="submit-btn" style="width: 17%; text-align: center;">Submit</button>
            </div>
        </form>

    </body>
    </html>
}







<script src="~/lib/jquery/dist/jquery.js"></script>
<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/ui/1.13.0/jquery-ui.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>

<script src="~/js/Get_ClassificationNames.js"></script>



















@*<script>
    var Tblleng = $('#TableData tr').length;
    debugger;
    for (var i = 2; i < Tblleng; i++) {
        var tdElement = document.getElementById('TableData').querySelectorAll('tr')[i].querySelectorAll('td')[7];
        var contentElement = tdElement.querySelector('.content');

        var commentTextAreavalue = $('#TableData tr:eq(' + i + ') .content #commentTextArea').val();
        if (commentTextAreavalue && commentTextAreavalue !== '') {
          

            var eyeIconElement = $('#TableData tr:eq(' + i + ') .eye-icon');
            eyeIconElement.show();
            
         

            var contentElement = $('#TableData tr:eq(' + i + ') .content');
            contentElement.show();

            var addCommentsBtnElement = $('#TableData tr:eq(' + i + ') .add-comments-btn');
            addCommentsBtnElement.val('Edit Comments');

        }

    }

    //for (var i = 2; i < Tblleng; i++) {
    //    debugger;
    //    var tdElement = document.getElementById('TableData').querySelectorAll('tr')[i].querySelector('td');
    //    var contentElement = tdElement.querySelector('.content');


    //    var commentTextAreavalue = $("#commentTextArea").val();
    //    if (commentTextAreavalue !== '') {


    //        var eyeIconElement = $('#TableData tr:eq(' + i + ') td:eq(7) .eye-icon');
    //        if (commentTextAreavalue !== '') {
    //            eyeIconElement.hide();
    //        }

    //        var contentElement = $('#TableData tr:eq(' + i + ') td:eq(7) .content');
    //        if (contentElement) {
    //            contentElement.show();
    //        }

    //        var addCommentsBtnElement = $('#TableData tr:eq(' + i + ') td:eq(7) .add-comments-btn');
    //        if (addCommentsBtnElement) {
    //            addCommentsBtnElement.value = 'Edit Comments';
    //        }
    //    }
    //    else {
    //        var eyeIconElement = $('#TableData tr:eq(' + i + ') td:eq(7) .eye-icon');
    //        if (commentTextAreavalue !== '') {
    //            eyeIconElement.show();
    //        }
    //    }
    //}

  
</script>*@




<script>
    var attendanceId1 = document.getElementById("AttendanceId1_Color_Chainge").textContent;
    var postingDateElement = document.getElementById("A_PostingDate");


    if (attendanceId1 && attendanceId1.trim().length > 0) {

        postingDateElement.style.color = "green";

    } else {
        postingDateElement.style.color = "red";
    }


@*click checkbox mails get one checkbox*@
@*<script>
        $(document).ready(function () {
            $("#submit-btn").click(function () {
                debugger;
                var rows = $("tbody").find("tr");

                var selectedEmails = [];
                var unselectedEmails = [];

                rows.each(function () {
                    var checkbox = $(this).find(".checkbox");
                    var email = $(this).find("td:nth-child(3)").text();

                    if (checkbox.prop("checked")) {
                        selectedEmails.push(email);
                    } else {
                        unselectedEmails.push(email);
                    }
                });

                var selectedEmailCount = selectedEmails.length;
                var unselectedEmailCount = unselectedEmails.length;

                var message = "";

                if (selectedEmailCount > 0) {
                    message += "Selected emails: " + selectedEmails.join(", ") + "\n";
                }

                if (unselectedEmailCount > 0) {
                    message += "Unselected emails: " + unselectedEmails.join(", ");
                }

                alert(message);

                // Pass the selected and unselected values to your action method or perform any desired action
            });
        });

    </script>*@

</script>
<!--Onely in table checkbox select code start-->
<script>
    $(document).ready(function () {
        $("#selectAll").click(function () {
            $(".checkbox").prop("checked", $(this).prop("checked"));
        });
    });
</script>



<!--Onely in table checkbox select code End-->
<!--Last Try-->
<style>
    * {
        box-sizing: border-box;
    }

    body {
        background: #EAEDF1;
        margin: 80px 0;
        font-family: 'Montserrat', sans-serif;
    }

    /*
    Popup
    Arrows and dropshadows are applied to .popup. Text align is "centered." You'll probably want to set it to "left."
    */
    .popup {
        width: 400px;
        margin: 0 auto;
        position: absolute;
        z-index: 999;
    }


        /*
    Different arrow positioning
    */
        .popup.arrow-top:before {
            left: calc(50% - 10px);
            top: -8px;
        }

        .popup.arrow-right:before {
            top: calc(50% - 10px);
            right: -8px;
        }

        .popup.arrow-bottom:before {
            left: calc(50% - 10px);
            bottom: -8px;
        }

        .popup.arrow-left:before {
            top: calc(50% - 10px);
            left: -8px;
        }


    .popup-wrapper {
        width: 100%;
        padding: 1px;
        border-radius: 15px;
        background: #fff;
        position: relative;
        margin-left: -262px;
        height: 200px;
        border: 2px solid blueviolet;
    }

    .close {
        float: right;
        font-size: 1.5rem;
        font-weight: 700;
        line-height: 1;
        color: #000;
        text-shadow: 0 1px 0 #fff;
        opacity: .5;
    }

    button.close {
        padding: 0;
        border: 0;
        -webkit-appearance: none;
        -moz-appearance: none;
    }

    #commentTextArea {
        border: 1px solid brown;
        border-radius: 4px;
        width: 87%;
        height: 100px;
        resize: unset;
        filter: drop-shadow(1px 2px 2px black);
    }
</style>
<!--Last Try-->
<!--popup show and checkbox hide and dropdown code start-->



<script>
    $(document).ready(function () {
       /* debugger;*/
        
        $(".eye-icon").click(function () {
           /* debugger;*/
            var row = $(this).closest("tr");
            var checkboxElement = row.find(".checkbox");
            var contentElement = row.find(".content");
            var btnElement = row.find(".add-comments-btn");

            if (checkboxElement.is(":visible")) {
                checkboxElement.hide();
                contentElement.show();
                btnElement.show();
            } else {
                checkboxElement.show();
                contentElement.hide();
            }
          
        });

        var Tblleng = $('#TableData tr').length;
        debugger;
        for (var i = 2; i < Tblleng; i++) {

            //var ddData  ddData
            var ddDataValue = $('#TableData tr:eq(' + i + ') .content #ddData').val();
           /* alert(ddDataValue);*/
            var commentTextAreavalue = $('#TableData tr:eq(' + i + ') .content #commentTextArea').val();
            debugger;
            var row = $('#TableData tr:eq(' + i + ')');
            if (ddDataValue != '--Select--' && ddDataValue != '') {
                if (typeof ddDataValue == 'undefined') {
                    row.find(".checkbox").show();
                } else {               
                row.find(".checkbox").hide();
                row.find(".eye-icon").show();
                row.find(".content").show();
                row.find(".add-comments-btn").val('Edit Comments').show();
                }
            }
            else {
                row.find(".checkbox").show();
                row.find(".eye-icon").show();
                row.find(".content").hide();
                row.find(".add-comments-btn").val('Add Comments');
            }
            //if ((ddDataValue == '' || ddDataValue !== '')&& commentTextAreavalue && commentTextAreavalue !== '') {
            //    row.find(".checkbox").hide();
            //    row.find(".eye-icon").show();
            //    row.find(".content").show();
            //    row.find(".add-comments-btn").val('Edit Comments').show();
            //} else {
            //    row.find(".checkbox").show();
            //    row.find(".eye-icon").show();
            //    row.find(".content").hide();
            //    row.find(".add-comments-btn").val('Add Comments');
            //}

              

        }






        $('.popup').hide();
        $('#TableData').on('click', '#CMT_BTN', function () {
            //   alert("CMT_BTN");
          /*  debugger;*/
            var clickedRow = $(this).closest("tr");
            var rowData = clickedRow.find("td:nth-child(4)").text();
            var popupContent = clickedRow.find("#popupContent");

            var rowDate = $("th#A_PostingDate").find("input.A_PostingDate").val();

            popupContent.text(rowData);
            $("#popuprowDate").text(rowDate);
            clickedRow.find(".popup").toggle();

        });
        $('.submit-comments-btn').on('click', function () {
          /*  debugger;*/
            var comment = $('#commentTextArea').val(); // Get the entered text from the textarea
            if (comment !== '') {

                console.log('Comment:', comment);
            }

            $('.popup').hide();
        });
    });


</script>
<!--popup show and checkbox hide and dropdown code End-->
