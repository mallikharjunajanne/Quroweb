@model Connect4m_Web.Models.Attendenceproperites.Fee_Section



@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!DOCTYPE html>
<html>
<head>
    <style>
        span.validation {
            display: block;
            color: red;
        }
        .PreviousPageBtn {
            border-radius: 8px;
            
            cursor: pointer;
            border: none !important;
            box-shadow: 0 5px 10px 2px rgba(88, 103, 221,0.19);
        }
        .NextPageBtn {
            border-radius: 8px;
            cursor: pointer;
            border: none !important;
            box-shadow: 0 5px 10px 2px rgba(88, 103, 221,0.19);
        }
        #DT_ValuesEdit option:checked {
            background-color: blue;
            color: white; /* Optionally change text color to white for better visibility */
        }
    </style>
    <link href="~/css/maps/FeeScetion_Styles.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
    
</head>
<body>
    <div class="card">
        <div class="card-header pb-0">
            <div style=" font-size: 20px; text-align: center;">
                <h1 style=" color: black; font-weight: 700; font-size: 20px; margin-top: -13px; ">MANAGE FEE TYPES</h1>
            </div>
        </div>
        <div style="text-align:left;">
            <p style="color:red;">@ViewBag.DeleteMessage</p>
        </div>
        <div style="margin-left: 81%; ">           
            <a class="btn btn-primary" style="color: white; font-size: 13px; margin-left: 3%; border-radius: 15px; height: 35px; border: 1px solid black !important; margin-bottom: 0px; font-family: auto; font-weight: 900;" href="#" onclick="Create_NewFeeSection(event);">Create Fee Type</a>
        </div>
        <div id="FeeTypesTbl_Divid">
            <div class="card-body">
                <div class="default-according style-1" id="accordionoc">
                    <div class="card">
                        <div>
                            <h5 class="mb-0">
                                <button class="HeaderBtn" data-bs-toggle="collapse" data-bs-target="#collapseicon" aria-expanded="true" aria-controls="collapse11" style="width: 99%;">SEARCH FEE TYPES</button>
                            </h5>
                        </div>
                        <div class="collapse show" id="collapseicon" aria-labelledby="collapseicon" data-bs-parent="#accordionoc" style="">
                            <div class="card-body">
                                <form class="form theme-form" id="SEARCH_FEE_TYPES_FORM">
                                    <div class="d-flex justify-content-center align-items-center">
                                        <div class="form-group row g-3">
                                            <div id="Ct_Lg_DivId" class="row" style=" margin-top: 10px;">
                                                <div style="display: flex; grid-gap: 16px;">
                                                    <label class="col-sm-5 col-form-label">Fee Type</label>
                                                    <div class="col-sm-9">
                                                        :<input type="text" name="FeeTypeSearchname" class="FeeType_Txt"/>
                                                    </div>
                                                </div>
                                                <div style="display: flex; grid-gap: 16px; margin-left: 22%; margin-top: 28px; ">

                                                    <a href="/FeeSection/ManageFeeConcedingTypes" class="btn btn-pill btn-outline-primary-2x PreviousPageBtn" >Previous Page</a>

                                                    <input type="reset" value="Clear" id="Clear_Btn" class="btn btn-pill btn-outline-danger-2x" style="border-radius:8px;">
                                                    <input type="submit" value="Search" style=" border-radius: 8px;" class="btn btn-pill btn-outline-success-2x" onclick="searchAndDisplayData(event);">
                                                    <a href="/FeeSection/ManageFeeTerms" class="btn btn-outline-info NextPageBtn">Next Page</a>

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            @*Table Html And Table Data Bind Code Start*@

            <div class="card-body">
                <div class="default-according style-1" id="accordionoc">
                    <div class="card">
                        <span id="ErrorMessage_SpanId" style="color: red; font-size: 12px; margin-left: 8px;"></span>
                        <h5 class="mb-0">
                            <button class="HeaderBtn" aria-controls="collapse11" style="width: 99%;">YOUR SEARCH RESULTED :<span id="TableCount" class="RecordsCount_Span" ></span> RECORDS.</button>
                        </h5>

                        <div class="collapse show" id="collapseicon" aria-labelledby="collapseicon" data-bs-parent="#accordionoc" style="">
                            <div class="card-body">

                                <table id="FeesectionTableContainer" class="FeeType_Tbl">
                                    <thead>
                                        <tr>
                                            <th>Fee Type</th>
                                            <th>Discount Type</th>
                                            <th>Description</th>
                                            <th>Delete</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                                <div id="FeeTypes_pagination" style="text-align:center;">

                                </div>


                            </div>
                        </div>
                    </div>
                </div>
            </div>

            @*Table Html And Table Data Bind Code End*@
        </div>


        @*Create New Fee type Code Start*@

        <div id="CreateFeeType_Divid">

            <div style="color:red; font-size:13px;">
                <div id="validation2" style="color: red;"></div>
                <div id="validationMessage" style="color: red;"></div>
                <p id="MessageID"></p>
            </div>
            <div class="card-body">
                <div class="default-according style-1" id="accordionoc">
                    <div class="card">
                        <div>
                            <h5 class="mb-0">
                                <button class="HeaderBtn" data-bs-toggle="collapse" data-bs-target="#collapseicon" aria-expanded="true" aria-controls="collapse11" style="width: 99%;">
                                    SAVE FEE TYPE
                                </button>
                            </h5>
                        </div>
                        <div class="collapse show" id="collapseicon" aria-labelledby="collapseicon" data-bs-parent="#accordionoc" style="">
                            <div class="card-body">
                                <form class="form theme-form" id="Create_New_FeeType">
                                    <div class="d-flex justify-content-center align-items-center">
                                        <div class="form-group row g-3">
                                            <div class="row" style=" margin-top: 10px;">
                                                <div style="display: flex; grid-gap: 16px;">
                                                    <label class="col-sm-4 col-form-label"><font style="color: red; font-size: 13px;">*</font>Fee Type :</label>
                                                    <div class="col-sm-9">
                                                        <input type="text" class="Feetypevalue" id="feeType" style="width: 48%; border: 1px solid #ccc; padding: 5px; box-sizing: border-box; height: 27px;" />
                                                    </div>
                                                </div>
                                                <div style="display: flex; grid-gap: 16px; width: 161%; margin-left: 0px; " id="DisplayFeeTypeRadioDivID">
                                                    <label class="col-sm-4 col-form-label"><font style="color: red; font-size: 13px;">*</font>Fee Type is for :</label>
                                                    <span style="width: 30%; ">
                                                        <input type="radio" id="Fee_Typeis_for" value="0" name="FeeTypeStatus" checked />Current Academic Year Payments
                                                    </span>

                                                    <span>
                                                        <input type="radio" id="Fee_Typeis_for" value="1" name="FeeTypeStatus" />Previous Academic Year Dues
                                                    </span>
                                                </div>

                                                <div style="display: flex; grid-gap: 16px;">
                                                    <label class="col-sm-4 col-form-label"><font style="color: red; font-size: 13px;"></font>Discount Types :</label>
                                                    @Html.ListBox("ConcedingtypeId", ViewBag.Discount_Types_DDValues as SelectList, new { @class = "DD_Lb", @id = "DT_Values" })
                                                </div>

                                                <div style="display: flex; grid-gap: 16px;" id="QuantityAmountID">
                                                    <span class="col-sm-4 col-form-label"><font style="color: red; font-size: 13px;"></font>Quantity :</span>
                                                    <span class="radio-style">
                                                        <input type="radio" name="quantity" id="quantityNo" value="0" checked style="margin: 6px 1px 0px 1px; ">
                                                        No
                                                    </span>
                                                    <span class="radio-style">
                                                        <input type="radio" name="quantity" id="quantityYes" value="1" style="margin: 6px 1px 0px 1px;">
                                                        Yes
                                                    </span>
                                                </div>
                                                <div style="display: flex; grid-gap: 16px;" id="AmotID">
                                                    <span class="col-sm-4 col-form-label"><font style="color: red; font-size: 13px;"></font>Amount :</span>
                                                    <input type="text" id="Amount" style="height: 30px; font-size: 14px;" maxlength="8" onkeypress="return isNumber(event)"/>
                                                </div>

                                                <div style="display: flex; grid-gap: 16px;">
                                                    <label class="col-sm-4 col-form-label"><font style="color: red; font-size: 13px;"></font>Description :</label>
                                                    <textarea class="DescriptionTA" id="description"></textarea>
                                                </div>
                                                <div style=" display: flex; grid-gap: 16px; margin-left: 87px; margin-top: 10px;">

                                                    <a href="/FeeSection/ManageFeeConcedingTypes" class="btn btn-pill btn-outline-primary-2x PreviousPageBtn">Previous Page</a>
                                                   
                                                    <input type="reset" value="Clear" id="Claer_btn"class="btn btn-pill btn-outline-danger-2x" style="border-radius: 8px; ">

                                                    <input type="submit" id="backToSearchBtn" value="Back to Search" style="border-radius: 8px;" class="btn btn-pill btn-outline-info-2x" onclick="backToSearch(event);">
                                                    <input type="submit" id="Create_New_FeeTypeBtn" value="Save" style="border-radius: 8px;" class="btn btn-pill btn-outline-warning-2x" onclick="saveFeeType(event);">
                                                   
                                                    <a href="/FeeSection/ManageFeeTerms" class="btn btn-outline-info NextPageBtn">Next Page</a>
                                                </div>


                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        @*Create New Fee type Code End*@

        @*/*Edit fields start*/*@

        <div id="UpdateFeeType_Divid">

            <div style="color:red; font-size:13px;">
                <div id="UpdateMessageID" style=" margin: 35px; display: flex; margin-top: -27px; "></div>
                <div id="Updatevalidation2" style=" margin: 35px; display: flex; margin-top: -27px; "></div>
                <div id="UpdatevalidationMessage"style=" margin: 35px; display: flex; margin-top: -27px; "></div>

            </div>
            <div class="card-body">
                <div class="default-according style-1" id="accordionoc" style="margin-top:-2%;">
                    <div class="card">
                        <div>
                            <h5 class="mb-0">
                                <button class="HeaderBtn" data-bs-toggle="collapse" data-bs-target="#collapseicon" aria-expanded="true" aria-controls="collapse11" style="width: 99%;">UPDATE FEE TYPE </button>
                            </h5>
                        </div>
                        <div class="collapse show" id="collapseicon" aria-labelledby="collapseicon" data-bs-parent="#accordionoc" style="">
                            <div class="card-body">
                                <form class="form theme-form" id="Create_New_FeeType">
                                    <div class="d-flex justify-content-center align-items-center">
                                        <div class="form-group row g-3">
                                            <div class="row" style=" margin-top: 10px;">
                                                <div style="display: flex; grid-gap: 16px;">
                                                    <input type="hidden" id="feeTypeIdEdit_Value" />
                                                    <input type="hidden" id="InstanceIdEdit_Value" />

                                                    <label class="col-sm-4 col-form-label"><font style="color: red; font-size: 13px;">*</font>Fee Type :</label>
                                                    <div class="col-sm-9">
                                                        <input type="text" id="feeTypeTextEdit_Value" style="width: 48%; border: 1px solid #ccc; padding: 5px; box-sizing: border-box; height: 27px;" />
                                                    </div>
                                                </div>
                                                <div style="display: flex; grid-gap: 16px; width: 161%; margin-left: 0px; ">
                                                    <label class="col-sm-4  col-form-label"><font style="color: red; font-size: 13px;">*</font>Fee Type is for :</label>
                                                    <span style="width: 30%; ">
                                                        <input type="radio" id="Fee_Typeis_for" value="0" name="FeeTypeStatusEdit_Value" />Current Academic Year Payments
                                                    </span>

                                                    <span>
                                                        <input type="radio" id="Fee_Typeis_for" value="1" name="FeeTypeStatusEdit_Value" />Previous Academic Year Dues
                                                    </span>
                                                </div>

                                                <div style="display: flex; grid-gap: 16px;">
                                                    <label class="col-sm-4  col-form-label"><font style="color: red; font-size: 13px;"></font>Discount Types :</label>
                                                    @Html.ListBox("ConcedingtypeIdEdit_Value", ViewBag.Discount_Types_DDValues as SelectList, new { @class = "DD_Lb", @id = "DT_ValuesEdit" })
                                                </div>

                                                <div style="display: flex; grid-gap: 16px;" id="QuantityAmountIDEdit">
                                                    <span class="col-sm-4  col-form-label"><font style="color: red; font-size: 13px;"></font>Quantity :</span>
                                                    <span class="radio-style">
                                                        <input type="radio" name="quantityEdit_Value" id="quantityNo" value="0" style="margin: 6px 1px 0px 1px; "onchange="toggleAmountField()">
                                                        No
                                                    </span>
                                                    <span class="radio-style">
                                                        <input type="radio" name="quantityEdit_Value" id="quantityYes" value="1" style="margin: 6px 1px 0px 1px;" onchange="toggleAmountField()">
                                                        Yes
                                                    </span>
                                                </div>
                                                <div style="display: flex; grid-gap: 16px;" id="AmotID_EditID">
                                                    <span class="col-sm-4  col-form-label"><font style="color: red; font-size: 13px;"></font>Amount :</span>
                                                    <input type="text" id="AmountEdit_Value" style="height: 30px; font-size: 14px;" maxlength="8" onkeypress="return isNumber(event)"/>
                                                </div>

                                                <div style="display: flex; grid-gap: 16px;">
                                                    <label class="col-sm-4  col-form-label"><font style="color: red; font-size: 13px;"></font>Description :</label>
                                                    <textarea class="DescriptionTA" id="descriptionEdit_Value"></textarea>
                                                </div>
                                                <div style=" display: flex; grid-gap: 16px; margin-left: 87px; margin-top: 10px;">
                                                    <a href="/FeeSection/ManageFeeConcedingTypes" class="btn btn-pill btn-outline-primary-2x PreviousPageBtn">Previous Page</a>
                                                    <input type="button" value="Delete" id="deleteButton" style="border-radius: 8px; " class="btn btn-pill btn-outline-danger-2x" onclick="Deletefeetype_UpdateView(event);" >
                                                    <input type="submit" id="EditTobackSearchBtn" value="Back to Search" class="btn btn-pill btn-outline-info-2x" style="border-radius: 8px;" onclick="EditTobackSearch(event);">
                                                    <input type="submit" id="Update_FeeTypeBtn" value="Update" class="btn btn-pill btn-outline-success-2x" style="border-radius: 8px;" onclick="UpdateFeeType(event);">
                                                    <a href="/FeeSection/ManageFeeTerms" class="btn btn-outline-info NextPageBtn">Next Page</a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        @* /*Edit fields END*/*@



    </div>



</body>
</html>






<script src="~/lib/jquery/dist/jquery.js"></script>
<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/ui/1.13.0/jquery-ui.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
@*<script src="~/js/Fee_Section_MFT.js"></script>*@


<script>
    $('#Claer_btn').click(function () {


        $("#validation2").text('');
        $("#MessageID").text('');
        $("#validationMessage").text('');

        $("#UpdateMessageID").text('');
        $("#UpdatevalidationMessage").text('');
          

        $("#feeType").val('');
        $("#DT_Values").val('');
        $("#Amount").val('');
        $("#description").val('');
    });

   
    function isNumber(event) {

        var inputValue = event.key;


        if (!/^\d*\.?\d*$/.test(inputValue)) {

            event.preventDefault();
        }
    }

    $(document).ready(function () {

        $("#CreateFeeType_Divid").hide();
        $("#UpdateFeeType_Divid").hide();


        Feesection_TbLData_Callingfunction();


        /* edit method calling function start*/
    

        $('#FeesectionTableContainer').on('click', 'td.feeType-cell', FeeType_Edit);


        /* edit method calling function End*/


        $('#AmotID').hide();

        $('input[name="quantity"]').change(function () {
            handleQuantityChange();
        });
      
        $('input[name="quantityEdit_Value"]').change(function () {
            toggleAmountField();
        });
         
    });


    /*  Edit Function Start */

    /*--------------------------------- Amount Div Hide and clear in edit View code start---------------------------------  */
    function toggleAmountField() {

        debugger;
        var quantityYesRadio = document.querySelector('input[name="quantityEdit_Value"][value="1"]');
        var amotID = document.getElementById("AmotID_EditID");

        if (quantityYesRadio.checked) {
            amotID.style.display = "flex";
            $('#AmountEdit_Value').val('');
        } else {
            amotID.style.display = "none";
        }
    }
    function handleQuantityChangesEdit() {
       
    }


    /*---------------------------------  Amount Div Hide and clear in edit View code End---------------------------------  */





    /*---------------------------------  Update validateForm code Start---------------------------------  */

    function UpdatevalidateForm() {
    /*    debugger;*/
        

        var U_feeType = $("#feeTypeTextEdit_Value").val();
        var AmountValue = $("#AmountEdit_Value").val();

        var U_feeTypeIsFor = $('input[name="FeeTypeStatusEdit_Value"]:checked').val();


        var Update_validationMessage = "";
        var hasError = false;

        if (U_feeType === "") {
            Update_validationMessage += "FeeType is required.<br>";
            hasError = true;
        }


        if (!U_feeTypeIsFor) {
            Update_validationMessage += "Fee Type is for selection is required.<br>";
            hasError = true;
        }

        if (hasError) {
            $('#Updatevalidation2').html("Following fields have invalid data :");
            $("#UpdatevalidationMessage").html(Update_validationMessage);
            return false; // Return false to prevent form submission
        } else {
            $("#UpdatevalidationMessage").html("");
            return true; // Return true to proceed with form submission
        }
    }

    /*---------------------------------  Update validateForm code End---------------------------------  */





    /*---------------------------------  Update Field Geting values function code Start---------------------------------  */

    function UpdateFeeType(event) {
        event.preventDefault();


        /*------- Update Validation calling this--------------------*/
        if (UpdatevalidateForm()) {

            debugger;

            $('#UpdateMessageID').text('');
            $('#Updatevalidation2').text('');
            $('#UpdatevalidationMessage').text('');
            


            var AmountValue = $("#AmountEdit_Value").val();
        
            var quantityYesRadio = document.querySelector('input[name="quantityEdit_Value"][value="1"]');

            if (quantityYesRadio.checked) {
                if (AmountValue != "") {
                
                    debugger;
                    var FeeTypeId = document.getElementById('feeTypeIdEdit_Value').value;
                    var InstanceId = document.getElementById('InstanceIdEdit_Value').value;
                    var FeeTypeName = document.getElementById("feeTypeTextEdit_Value").value;
                    var FeeTypeStatus = document.querySelector('input[name="FeeTypeStatusEdit_Value"]:checked').value;


                    var selectedValue = $('#DT_ValuesEdit').val();

                    var quantity = document.querySelector('input[name="quantityEdit_Value"]:checked').value;
                    var amount = document.getElementById("AmountEdit_Value").value;
                    var description = document.getElementById("descriptionEdit_Value").value;

                    var UpdateFee_Data = {
                        FeeTypeId: FeeTypeId,
                        InstanceId: InstanceId,
                        FeeType: FeeTypeName,
                        FeeTypeStatus: FeeTypeStatus,
                        ConcedingTypeId: selectedValue,
                        Quantity: quantity,
                        Amount: amount,
                        Description: description
                    };

                    // Call the Update  ManageFeeTypes function and pass the form data
                    Update_FeeTypes(UpdateFee_Data);
                } else {
                    $('#Updatevalidation2').html("Following fields have invalid data:");
                    $('#UpdatevalidationMessage').html("Please Enter Valid Amount.");
                    return false;
                }
            } else {
                debugger;
                var FeeTypeId = document.getElementById('feeTypeIdEdit_Value').value;
                var InstanceId = document.getElementById('InstanceIdEdit_Value').value;
                var FeeTypeName = document.getElementById("feeTypeTextEdit_Value").value;
                var FeeTypeStatus = document.querySelector('input[name="FeeTypeStatusEdit_Value"]:checked').value;


                var selectedValue = $('#DT_ValuesEdit').val();

                var quantity = document.querySelector('input[name="quantityEdit_Value"]:checked').value;
                var amount = document.getElementById("AmountEdit_Value").value;
                var description = document.getElementById("descriptionEdit_Value").value;

                var UpdateFee_Data = {
                    FeeTypeId: FeeTypeId,
                    InstanceId: InstanceId,
                    FeeType: FeeTypeName,
                    FeeTypeStatus: FeeTypeStatus,
                    ConcedingTypeId: selectedValue,
                    Quantity: quantity,
                    Amount: amount,
                    Description: description
                };
                                
                Update_FeeTypes(UpdateFee_Data);
            }
        }
    }

    /*---------------------------------  Update Field Geting values function code End---------------------------------  */




    /*---------------------------------  Update Field Geting values tTo pass Action Method function code Start---------------------------------  */

    function Update_FeeTypes(UpdateFee_Data) {

        var F_T_Name = document.getElementById("feeTypeTextEdit_Value").value;
        var formData = new FormData();

        formData.append("FeeTypeId", UpdateFee_Data.FeeTypeId);
        formData.append("InstanceId", UpdateFee_Data.InstanceId);
        formData.append("FeeType", UpdateFee_Data.FeeType);
        formData.append("FeeTypeStatus", UpdateFee_Data.FeeTypeStatus);
        formData.append("ConcedingTypeId", UpdateFee_Data.ConcedingTypeId);
        formData.append("Quantity", UpdateFee_Data.Quantity);
        formData.append("Amount", UpdateFee_Data.Amount);
        formData.append("Description", UpdateFee_Data.Description);
        formData.append("F_T_Name", F_T_Name);

        $.ajax({
            url: '/FeeSection/FeeType_Edit_To_Update',
            method: 'POST',           
            data: formData,
            processData: false, 
            contentType: false,
            success: function (response) {
               
                debugger;
                console.log(response);
                if (response == "1") {
                  
                    $("#UpdateMessageID").text("Record updated successfully.");
                   
                } else if (response == "3") {
                    $("#UpdateMessageID").text('Cannot Update DiscountType(s) for FeeType' + '"' + F_T_Name + '"' +',It is Associated with Few Students.');
                }


                else if (response == "2") {
                    $("#UpdateMessageID").text("Record updated successfully.");
                }
                else if (response == "0") {

                    $("#UpdateMessageID").text("Fee Type with Name " + '"' + feeType + '"' + " already exists.");

                } else if (response == "") {

                    $('#UpdateMessageID').text('Record updated successfully.');
                }
                else {
             
                    $("#UpdateMessageID").text("Failed to insert the record. Please try again.");
                  
                }
            },
            error: function () {
                console.log('Error saving fee type.');
            }
        });
    }

    /*---------------------------------  Update Field Geting values tTo pass Action Method function code End---------------------------------  */



    /*---------------------------------  Edit Fields Geting values To pass parameter Action Method and Append that values In fileds function code start---------------------------------  */

    function FeeType_Edit(FeeTypeId) {
    

        $('#UpdateMessageID').text('');
        $('#Updatevalidation2').text('');
        $('#UpdatevalidationMessage').text('');

        $.ajax({
            url: '/FeeSection/FeeType_Edit', // Update with the appropriate URL
            method: 'GET',
            data: {
                FeeTypeId: FeeTypeId
            },
            success: function (response) {

                debugger;
                // Populate the form fields with the received data
                $('#feeTypeIdEdit_Value').val(response[0].feeTypeId);
                $('#InstanceIdEdit_Value').val(response[0].instanceId);



                $('#feeTypeTextEdit_Value').val(response[0].feeType);


               
                if (response[0].feeTypeStatus == 'false') {

                    $('input[name="FeeTypeStatusEdit_Value"][value="0"]').prop('checked', true); //Current Academic Year Payments

                } else if (response[0].feeTypeStatus == 'true') {

                    $('input[name="FeeTypeStatusEdit_Value"][value="1"]').prop('checked', true); //Previous Academic Year Dues

                }

               
              
                $('#DT_ValuesEdit').val('');                            

                $.each(response, function (index, item) {
                    var concedingTypeName = item.concedingTypeName;
                    $('#DT_ValuesEdit option').filter(function () {
                        return $(this).text() == concedingTypeName;
                    }).prop('selected', true);
                });
                $('#DT_ValuesEdit option[value=""]').prop('selected', false);

                $('input[name="quantityEdit_Value"]').prop('checked', false); // Uncheck all radio buttons

                debugger;
                if (response[0].quantity == 'true') {
                    $('input[name="quantityEdit_Value"][value="1"]').prop('checked', true); // Yes

                    var amountValue = response[0].amount;
                    if (amountValue) {
                        $('#AmountEdit_Value').val(amountValue);
                        $('#AmotID_EditID').show();
                        $('#AmountEdit_Value').show();
                    } else {
                        $('#AmotID_EditID').hide();
                    }
                } else if (response[0].quantity == 'false') {
                    $('input[name="quantityEdit_Value"][value="0"]').prop('checked', true); // No

                    $('#AmotID_EditID').hide();
                }



              
             


                $('#descriptionEdit_Value').val(response.description);
              


                // Show the update section
                $('#CreateFeeType_Divid').hide();
                $('#FeeTypesTbl_Divid').hide();
                $('#UpdateFeeType_Divid').show();
            },
            error: function () {
                console.log('Error fetching Fee Type data.');
            }
        });
    }
    /*---------------------------------  Edit Fields Geting values To pass parameter Action Method and Append that values In fileds function code End---------------------------------  */


    /*---------------------------------  IN EDIT VIEW  BACK TO SEARCH HIDE SOME DIV IDS AND SHOW SOME DIV IDS FUNCTION CODE START ---------------------------------  */

    function EditTobackSearch(event) {

        event.preventDefault();

        Feesection_TbLData_Callingfunction();
        $("#ErrorMessage_SpanId").html('');
        $("#MessageID").html('');

        $("#UpdateMessageID").html('');
        $("#UpdatevalidationMessage").html('');

        $("#FeeTypesTbl_Divid").show();
        $("#CreateFeeType_Divid").hide();
        $('#UpdateFeeType_Divid').hide();




        $('.FeeType_Txt').val('');
        $('#feeTypeTextEdit_Value').val('');
        $('#DT_ValuesEdit').val('');
        $('#AmountEdit_Value').val('');
        $('#descriptionEdit_Value').val('');
       


    }
    /*---------------------------------  IN EDIT VIEW  BACK TO SEARCH HIDE SOME DIV IDS AND SHOW SOME DIV IDS FUNCTION CODE END ---------------------------------  */


    /*  Edit Function End */



    /*---------------------------------  IN CREATE VIEW  BACK TO SEARCH HIDE SOME DIV IDS AND SHOW SOME DIV IDS FUNCTION CODE START ---------------------------------  */

    // Function to show/hide the div elements
    function backToSearch(event) {
        event.preventDefault();

        Feesection_TbLData_Callingfunction();

        $("#ErrorMessage_SpanId").html('');
        $("#MessageID").html('');

        $("#UpdateMessageID").html('');
        $("#UpdatevalidationMessage").html('');

        $("#FeeTypesTbl_Divid").show();
        $("#CreateFeeType_Divid").hide();



        $(".FeeType_Txt").val('');
       $("#feeType").val('');
        $("#DT_Values").val('');
        $("#Amount").val('');
        $("#description").val('');
       
    }




    /*----------Create  New Fee Type table Hide and fileds are showing code start------------------------*/

    function Create_NewFeeSection(event) {
    
        event.preventDefault();

        debugger;
        /*----------- Messages Ids data Clear------------------*/

        $("#feeType").val('');
        $("#DT_Values").val('');
        $("#description").val('');
        $("#Amount").val('');
          
       
        $('#DisplayFeeTypeRadioDivID').find('#Fee_Typeis_for').prop('checked', false);
        $('#DisplayFeeTypeRadioDivID').find('#Fee_Typeis_for').prop('checked', true);
        $('#QuantityAmountID').find('#quantityYes').prop('checked', false);
        $('#QuantityAmountID').find('#quantityNo').prop('checked', true);
  
        handleQuantityChange();     


        $("#ErrorMessage_SpanId").html('');
        $("#MessageID").html('');
        $("#validationMessage").html('');
        $("#validation2").html('');

        /*----------- Messages Ids data Clear------------------*/

       
        $('#UpdateFeeType_Divid').hide();
        $("#FeeTypesTbl_Divid").hide();
        $("#CreateFeeType_Divid").show();
       
        
    }

    /*----------Create  New Fee Type table Hide and fileds are showing code End------------------------*/

    /*---------------------------------  IN CREATE VIEW  BACK TO SEARCH HIDE SOME DIV IDS AND SHOW SOME DIV IDS FUNCTION CODE END ---------------------------------  */

    function searchAndDisplayData(event) {
        event.preventDefault();

        // Get the search input value
        var feeTypeSearchname = document.getElementsByName("FeeTypeSearchname")[0].value;
      

        // Call the Feesection_TbLData_Callingfunction and pass the search value as a parameter
        Feesection_TbLData_Callingfunction(feeTypeSearchname);
    }

    /*--------------------------  TbLData FUNCTION START-------------------------- */
    function Feesection_TbLData_Callingfunction(feeTypeSearchname) {


        $.ajax({
            url: '/FeeSection/Tbl_FeeTypes',
            method: 'GET',
            data: { FeeTypeSearchname: feeTypeSearchname },
            success: function (response) {
                
            /*    debugger;*/

                var CountTabledata = response.length;          

                $('#TableCount').text(CountTabledata);

                console.log(response); // Log the response object in the browser's console



                var table = $('#FeesectionTableContainer');
                var tbody = table.find('tbody');
                var rowsPerPage = 10; // Number of rows to display per page

                // Clear the existing table body
                tbody.empty();

                // Iterate over the data and create table rows
                $.each(response, function (index, feeSection) {
                    var row = $('<tr></tr>');


                   

                    // Create table cells and populate with data
                

                    var cell1 = $('<td class="editable-cell"></td>').css('cursor', 'pointer');
                    var text = $('<span></span>').text(feeSection.feeType).css({
                        'color': 'black',
                        'font-weight': 'bold',
                        'text-decoration': 'underline'
                    }).attr('onclick', 'FeeType_Edit(' + feeSection.feeTypeId + ')');
                    cell1.append(text);


                    var cell2 = $('<td></td>').text(feeSection.concedingTypeName);
                    var cell3 = $('<td></td>').text(feeSection.description);
                    var cell4 = $('<td></td>').css('text-align', 'center');
                    var deleteIcon = $('<i></i>').addClass('fas fa-trash-alt'); // Assuming you're using Font Awesome icons
                    deleteIcon.data('row', row);
                    cell4.append(deleteIcon);


                    var cell5 = $('<td hidden></td>').text(feeSection.instanceId);
                    var cell6 = $('<td hidden></td>').text(feeSection.concedingTypeId);
                    var cell7 = $('<td hidden></td>').text(feeSection.feeTypeId);                  




                    // Append the cells to the row
                    row.append(cell1);
                    row.append(cell2);
                    row.append(cell3);
                    row.append(cell4);
                    row.append(cell5);
                    row.append(cell6);
                    row.append(cell7);

                    // Append the row to the table body
                    tbody.append(row);
                });

                // Perform pagination
                var numPages = Math.ceil(response.length / rowsPerPage);
                var pagination = $('#FeeTypes_pagination');
                pagination.empty();

                // Create pagination links
                var previousLink = $('<a class="FeeTypes_pagination" style="margin: 0 2px;" href="#">Previous</a>');
                pagination.append(previousLink);

                for (var i = 1; i <= numPages; i++) {
                    var link = $('<a class="FeeTypes_pagination" style="margin: 0 2px;" href="#">' + i + '</a>');
                    pagination.append(link);
                }

                var nextLink = $('<a class="FeeTypes_pagination" style="margin: 0 2px;" href="#">Next</a>');
                pagination.append(nextLink);

                // Show the first page by default
                showPage(1);

                // Adjust pagination alignment
                pagination.css('text-align', 'center');

                // Handle pagination link click event
                pagination.on('click', '.FeeTypes_pagination', function (e) {
                    e.preventDefault();
                    var page = $(this).text();
                    if (page === "Previous") {
                        var currentPage = $('.FeeTypes_pagination.active').text();
                        page = parseInt(currentPage) - 1;
                        if (page < 1) {
                            page = 1;
                        }
                    } else if (page === "Next") {
                        var currentPage = $('.FeeTypes_pagination.active').text();
                        page = parseInt(currentPage) + 1;
                        if (page > numPages) {
                            page = numPages;
                        }
                    } else {
                        page = parseInt(page);
                    }
                    showPage(page);
                });

                // Function to display the specified page
                function showPage(page) {
                    var start = (page - 1) * rowsPerPage;
                    var end = start + rowsPerPage;

                    tbody.find('tr').hide(); // Hide all rows
                    tbody.find('tr').slice(start, end).show(); // Show rows for the specified page

                    if (response.length <= rowsPerPage) {
                        pagination.hide();
                    } else {
                        pagination.show();
                    }

                    $('.FeeTypes_pagination').removeClass('active');
                    $('.FeeTypes_pagination').eq(page).addClass('active');
                }

            },
            error: function () {
                console.log('Error retrieving data.');
            }
        });
    }
    /*--------------------------  TbLData FUNCTION End-------------------------- */
   
    /*--------------------------  Delete FUNCTION START-------------------------- */

    function Deletefeetype_UpdateView() {
        debugger;

       var FeeTypeId= $('#feeTypeIdEdit_Value').val();
       var InstanceId= $('#InstanceIdEdit_Value').val();
        var FeeTypeName = $('#feeTypeTextEdit_Value').val();
        var FeeTypeisfor = $('#Fee_Typeis_for').val();
        var DiscountTypeIds = $('#DT_ValuesEdit').val();
        if (DiscountTypeIds && DiscountTypeIds.length > 0) {
            var firstSelectedValue = DiscountTypeIds[0]; // Get the first selected value
            var ConcedingTypeName = $('#DT_ValuesEdit option[value="' + firstSelectedValue + '"]').text(); // Get the text of the first selected value
            console.log("First Selected Value:", firstSelectedValue);
            console.log("First Selected Text:", ConcedingTypeName);
        } else {
            console.log("No options selected");
        }
        debugger;

        var Qunatity = $('#quantityNo').val();
        var Amoount = $('#AmountEdit_Value').val();
        var Description = $('#descriptionEdit_Value').val();

        if (confirm('Are you sure you want to delete this FeeType?\nClick OK to delete or Cancel to stop deleting.')) {

            var deleteButton = document.getElementById("deleteButton"); // Replace "deleteButton" with the actual ID of your button
            if (deleteButton) {
                deleteButton.disabled = true;
            }

                $.ajax({
                    url: '/FeeSection/Delete_FeeType',
                    method: 'POST',
                    data: {
                        instanceId: InstanceId,
                        concedingTypeId: DiscountTypeIds,
                        feeTypeId: FeeTypeId
                    },
                    success: function (response) {

                        $("#FeeTypesTbl_Divid").hide();
                        $("#CreateFeeType_Divid").hide();
                        $("#UpdateFeeType_Divid").show();


                        if (response == '1') {

                            $('#UpdateMessageID').text('Record deleted successfully.');                           
                           

                        } else if (response == '2') {  
                            $('#UpdateMessageID').text('DiscountType' + '"' + ConcedingTypeName + '"' + 'is Deleted For the FeeType ' + '"' + FeeTypeName + '"');



                        } else if (response == '0') {
                            $('#UpdateMessageID').text('This Fee Type is Associated with Few Students you cannot delete it.');

                        } else if (response == '-1') {

                            $('#UpdateMessageID').text('This Fee Type is Associated with Few Students you cannot delete it.');

                        } else if (response == response) {

                            $('#UpdateMessageID').text('Record deleted successfully.');

                        } else {
                            alert('Null');
                        }
                    },
                    error: function () {
                        console.log('Error deleting Fee Type.');
                    }
                });
           
        }

    };




    $('#FeesectionTableContainer').on('click', '.fa-trash-alt', function () {
        var row = $(this).data('row');

        var instanceId = $(this).closest('tr').find('td:nth-child(5)').text();
        var concedingTypeId = $(this).closest('tr').find('td:nth-child(6)').text();
        var feeTypeId = $(this).closest('tr').find('td:nth-child(7)').text();
        var ConcedingTypeName = $(this).closest('tr').find('td:nth-child(2)').text();
        var Description = $(this).closest('tr').find('td:nth-child(3)').text();

        if (confirm('Are you sure you want to delete this FeeType?\nClick OK to delete or Cancel to stop deleting.')) {
            deleteFeeType(instanceId, concedingTypeId, feeTypeId, ConcedingTypeName, Description, row);
        }
    });

    function deleteFeeType(instanceId, concedingTypeId, feeTypeId, ConcedingTypeName, Description, row) {
   

        $.ajax({
            url: '/FeeSection/Delete_FeeType',
            method: 'POST',
            data: {
                instanceId: instanceId,
                concedingTypeId: concedingTypeId,
                feeTypeId: feeTypeId
            },
            success: function (response) {
             
                if (response == '1') {
                    $('#ErrorMessage_SpanId').text('Record deleted successfully.');
                    row.remove();
                    Feesection_TbLData_Callingfunction();
                    window.scrollTo(0, 0);
                } else if (response == '2') {
                    $('#ErrorMessage_SpanId').text('DiscountType' + '"' + ConcedingTypeName + '"' + 'is Deleted For the FeeType ' + '"' + Description + '"');
                  
                    row.find('td:eq(1)').empty();
                    Feesection_TbLData_Callingfunction();

                } else if (response == '0') {
                    $('#ErrorMessage_SpanId').text('This Fee Type is Associated with Few Students you cannot delete it.');
                 
                } else if (response == '-1') {

                    $('#ErrorMessage_SpanId').text('This Fee Type is Associated with Few Students you cannot delete it.');

                } else if (response == response) {

                    $('#ErrorMessage_SpanId').text('Record deleted successfully.');

                } else {
                    alert('Null');
                }
            },
            error: function () {
                console.log('Error deleting Fee Type.');
            }
        });
    }
    /*--------------------------  Delete FUNCTION END -------------------------- */

    /*--------------------------  VALIDATION FUNCTION START-------------------------- */
    function validateForm() {
      /*  debugger;*/

      
        var feeType = $("#feeType").val();
       
        var feeTypeIsFor = $('input[name="FeeTypeStatus"]:checked').val();


        var validationMessage = "";
        var hasError = false;

        if (feeType === "") {
            validationMessage += "FeeType is required.<br>";
            hasError = true;
        }
        

        if (!feeTypeIsFor) {
            validationMessage += "Fee Type is for selection is required.<br>";
            hasError = true;
        }

        if (hasError) {
            $('#validation2').html("Following fields have invalid data :");
            $("#validationMessage").html(validationMessage);
            return false; // Return false to prevent form submission
        } else {
            $("#validationMessage").html("");
            return true; // Return true to proceed with form submission
        }
    }
    /*--------------------------  VALIDATION FUNCTION END -------------------------- */






    /*--------------------------  Create New Fee Type Functions Start -------------------------- */
    function saveFeeType(event) {
        event.preventDefault();

      
        if (validateForm()) {

            $('#validation2').text('');
            $('#validationMessage').text('');
            $('#MessageID').text('');

            debugger
       
        var feeType = document.getElementById("feeType").value;
        var feeTypeStatus = document.querySelector('input[name="FeeTypeStatus"]:checked').value;
        var concedingtypeIds = Array.from(document.getElementById("DT_Values").selectedOptions).map(option => option.value);
      

        var quantity = document.querySelector('input[name="quantity"]:checked').value;
        var amount = document.getElementById("Amount").value;
        var description = document.getElementById("description").value;

        debugger;
      
        var formData = {
            FeeType: feeType,
            FeeTypeStatus: feeTypeStatus,
            ConcedingtypeIds: concedingtypeIds,
            Quantity: quantity,
            Amount: amount,
            Description: description
        };

      
            manageFeeTypesdata(formData);
        }
    }

    function manageFeeTypesdata(formData) {
        debugger;
        var feeType = document.getElementById("feeType").value;
        $.ajax({
            url: '/FeeSection/ManageFeeTypes',
            method: 'POST',
            data: formData,
            success: function (response) {
                // Handle the response as needed
                debugger;
                console.log(response);
                if (response == "1") {
                    // Handle the case when the record is inserted successfully
                    $("#MessageID").text("Record inserted successfully!");
                    // Perform any additional actions or page redirection if needed
                }
                else if (response == "2") {
                    $("#MessageID").text("Record inserted successfully!");
                }
                else if (response == "0") {
                    
                         $("#MessageID").text("Fee Type with Name " + '"'+feeType+'"' +  " already exists.");

                } else if (response == response) {

                    $('#MessageID').text('Record inserted successfully.');
                }
                else {
                    // Handle the case when the record insertion fails
                    $("#MessageID").text("Failed to insert the record. Please try again.");
                    // Perform any additional error handling or display error messages
                }
            },
            error: function () {
                console.log('Error saving fee type.');
            }
        });
    }

    /*-------------------------- Create New Fee Type Functions End---------------------------------------------*/

    /*--------------------------  AMount Text Box hide and show  start function-------------------------- */

    function handleQuantityChange() {
        debugger;
        var quantityYesRadio = document.getElementById("quantityYes");
        var amotID = document.getElementById("AmotID");
       
        if (quantityYesRadio.checked) {
            amotID.style.display = "flex";
            $('#Amount').val('');
           
        } else {
            amotID.style.display = "none";           
        }
    }


    /*--------------------------  AMount Text Box hide and show  End function-------------------------- */





</script>


















