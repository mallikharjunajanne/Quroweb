@model Connect4m_Web.Models.Attendenceproperites.UserScreen.NoticeTypes
@{
    ViewData["Title"] = "ManageNotices";
    Layout = "~/Views/Shared/_Layout.cshtml";
}



<!DOCTYPE html>
<html>
<head>

</head>
<body>
    <div class="flex-grow-1 container-p-y container-xxl ">
        <h4 class="py-3 mb-4"><span class="text-muted fw-light">Admin /</span>Manage Notices</h4>
        <span id="Message_spid" class="text-danger"></span>


        <div class="col-sm-12 text-end">
            <a href="javascript:void(0);" id="Addnotice" class="btn btn-outline-primary btn-xs">Create Notice</a>
            |
            <a href="javascript:void(0);" id="AddnewSMS" class="btn btn-outline-primary btn-xs">Create SMS</a>
            |
            <a href="javascript:void(0);" id="AddnewSMSNNotices" class="btn btn-outline-primary btn-xs">Create Notice and SMS</a>
        </div>
        <div id="Home_SearchNoticesdiv">
            <div class="row mb-2">
                <div class="col-md-12 col-lg-12 mb-3" id="Search_NoticeView">
                    <div class="card mb-4">
                        <div class="card-header d-flex align-items-center justify-content-between">
                            <h5 class="mb-0">
                                SEARCH NOTICES
                            </h5>
                        </div>
                        <div class="card-body" id="CreateNewSubjectsDiv">
                            <form id="FmSubjectSearch">
                                <div class="row mb-3">
                                    <label class="control-label col-sm-4 col-form-label text-end space">Notice Type</label>
                                    <div class="col-sm-4">
                                        <select class="form-select select2 form-select select2-hidden-accessible" id="ENoticetypeid">
                                        </select>
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <label class="control-label col-sm-4 col-form-label text-end space">Notice Subject</label>
                                    <div class="col-sm-4">
                                        <input type="text" id="SubjectTXT" class="form-control" />
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <label class="control-label col-sm-4 col-form-label text-end space">Start Date</label>
                                    <div class="col-sm-4">
                                        <input type="date" id="StartDateTXT" class="form-control" />

                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <label class="control-label col-sm-4 col-form-label text-end space">End Date</label>
                                    <div class="col-sm-4">
                                        <input type="date" id="EndDateTXT" class="form-control" />
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <label class="control-label col-sm-4 col-form-label  text-end "></label>
                                    <div class="col-sm-6">
                                        <input id="checkbox-primary" class="form-check-input checkbox-item Scl_Checkbox" type="checkbox" name="IsSMSTemplate" value="0" />
                                        <label class="col-sm-4">SMS Template</label>
                                    </div>
                                </div>
                                <div class="row justify-content text-center">
                                    <div class="col-sm-12">
                                        <button class="btn btn-warning waves-effect waves-light" id="Noticebtnclear">Clear</button>@*Clearcoollink_Btn*@
                                        <button type="button" class="btn btn-success waves-effect waves-light" id="Noticesearchbtn">Search</button>@*SearchNotice_Btn*@
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div id="Searchnoticestablediv">
                <div class="col-md-12 col-lg-12 mb-3">
                    <span class="text-danger" id="ErrorMessage"></span>
                    <div class="card mb-4">
                        <div class="card-header d-flex align-items-center justify-content-between">
                            <h5 class="mb-0">
                                YOUR SEARCH RESULTED <span id="ManageNoticetblRecordscount"></span> RECORDS.
                            </h5>
                        </div>
                        <table class="table table-bordered" id="ManageNoticetbl">
                            <thead class="table-dark">
                                <tr>
                                    <th style="width: 5%;">SNO</th>
                                    <th style="width: 30%;">Notice Subject</th>
                                    <th>End Date(Expiry Date)</th>
                                    <th>Posted</th>
                                    <th>Delete</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div id="Home_SearchNotices_Updatediv" style="display:none;">
            @*Edit_NoticeView*@
            <div style="color:red;font-size:13px;">
                <span id="UpdateErrorMessage"></span>
                <span id="Updatevalidation"></span>
                <span id="UpdatevalidationMessage"></span>
            </div>
            <div class="col-md-12 col-lg-12 mb-3" id="Search_NoticeView">
                <div class="card mb-4">
                    <div class="card-header d-flex align-items-center justify-content-between">
                        <h5 class="mb-0">
                            UPDATE NOTICE
                        </h5>
                    </div>
                    <div class="card-body" id="CreateNewSubjectsDiv">
                        <form id="Notice_UpdateForm">
                            <div class="row mb-3">
                                <label class="control-label col-sm-4 col-form-label text-end required space">Notice Type</label>
                                <div class="col-sm-4">
                                    <input type="hidden" asp-for="ENoticeId" id="ENoticeId_UTXT" />
                                    <select id="ENoticeTypeId_UTXT" asp-for="ENoticeTypeId" class="form-select">
                                        <option value="">---Select----</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <label class="control-label col-sm-4 col-form-label text-end required space">Notice Subject</label>
                                <div class="col-sm-4">
                                    <textarea id="Subject_UTXT" asp-for="Subject" class="form-control" maxlength="1000" oninput="updateCharCount()"></textarea>
                                    <span id="charCount"></span>
                                    <span id="Characterslength"></span>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <label class="control-label col-sm-4 col-form-label text-end  "></label>
                                <div class="col-sm-7">
                                    <b>NOTE</b>: Invalid Characters in sending SMS: <b>% & < ></b>
                                    Some Characters like <b>` ~ ^ + $</b> may not deliver properly to all mobiles.
                                    <b>Messages sent between 9PM and 9AM will be delivered after 9AM</b>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <label class="control-label col-sm-4 col-form-label text-end  space">Description </label>
                                <div class="col-sm-4">
                                    <textarea id="ENoticeDescription_UTXT" asp-for="ENoticeDescription" class="form-control" maxlength="6500" oninput="Charactercounting()"></textarea>
                                    <span id="DescriptionCharactercount"></span>
                                    <span id="Characterlength"></span>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <label class="control-label col-sm-4 col-form-label text-end required space">Start Date </label>
                                <div class="col-sm-4">
                                    <input type="date" id="StartDate_UTXT" asp-for="StartDate" class="form-control" />
                                </div>
                            </div>
                            <div class="row mb-3">
                                <label class="control-label col-sm-4 col-form-label text-end required space">End Date(Expiry Date) </label>
                                <div class="col-sm-4">
                                    <input type="date" id="EndDate_UTXT" asp-for="ExpiryDate" class="form-control" />
                                </div>
                            </div>
                            <div class="row mb-3">
                                <label class="control-label col-sm-4 col-form-label text-end  space"> Upload Notice document </label>
                                <div class="col-sm-4">
                                    <span id="currentFileName"></span>
                                    <input type="file" id="NoticeDocument_UTxtFile" name="noticeDocument" asp-for="AttachedDocument" style="display:none;">
                                    <input type="button" id="deleteFileBtn" value="Delete" />
                                </div>
                            </div>
                            <div class="row mb-3">
                                <label class="control-label col-sm-4 col-form-label text-end required space">Display this Notice in Login </label>
                                <div class="col-sm-4">
                                    <div class="radio radio-primary">
                                        <input id="radioinline1" type="radio" asp-for="ShowInLogin" name="radio1" value="0">
                                        <label class="mb-0" for="radioinline1">No</label>
                                        <input id="radioinline2" type="radio" asp-for="ShowInLogin" name="radio1" value="1">
                                        <label class="mb-0" for="radioinline2">Yes</label>
                                    </div>
                                </div>
                            </div>
                            <div class="row justify-content text-center">
                                <div class="col-sm-12">
                                    <button type="reset" class="btn btn-warning waves-effect waves-light" id="DeleteNotice_UpBtn">Delete</button>
                                    <button type="button" class="btn btn-dark waves-effect waves-light" id="BacktosearchNotice_Btn">BackToSearch</button>
                                    <button type="button" class="btn btn-info waves-effect waves-light" id="btnpostnotice">Post this Notice</button>
                                    <button type="button" class="btn btn-success waves-effect waves-light" id="UpdateNotice_Btn">Update</button>
                                    <button type="button" class="btn btn-primary waves-effect waves-light" id="btnnoticeupdatepost">Update and Post</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div id="Addnotice_div1">

        </div>

        <div id="Addsms_div2">
            @*ManageNotices_CreateSMS_ViewDivid*@

        </div>

        <div id="Addnoticeandsms_div3">
            @*ManageNotices_CreateSMSNNotice_ViewDivid*@

        </div>

        <div id="Postnoticemailsmsdiv">

        </div>
        <div id="ManageNotices_CreateSMS_SaveandPostbtnclick_PostNoticeDiv_id">

        </div>


    </div>




    @*<div id="SearchNoticetableview">
        <div style="color:red;font-size:13px;"><span id="ErrorMessage"></span></div>
        <div id="Noticetabledata_div">
        </div>
    </div>
    <div class="card">
        <div id="Create_NoticeView">
        </div>
    </div>*@

</body>
</html>

<script src="~/lib/jquery/dist/jquery.js" type="text/javascript"></script>

@*<script src="~/lib/jquery/dist/jquery.js"></script>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>*@
<script src="~/js/ManageNotices.js"></script>

@*<script src="~/js/Managenotice_1.js"></script>*@

<script>

    $(document).ready(function () {

       // managenotice_tabledata();
        $('#ManagenoticeMaindiv').show();
        $('#Home_SearchNotices_Updatediv').hide();
        //var Instanceid = $('#Instance_Txtid').val();
        //var Loginuser = $('#Loginuser_Txtid').val();

        NoticeDropdown_UpdateNotice_In_View();        


       

    });


   


    /*--------CREATE NOTICE VIEWS CODE START-----------*/

    $("a.btn-outline-primary").on("click", function (e) {
        e.preventDefault();

        $('#ManagenoticeMaindiv').hide();
        $('#Home_SearchNotices_Updatediv').hide();
        $('#ErrorMessage').text("");

        $('#Managenotice_CreateSMS_Divid').remove();

        $("#Addnotice_div1").load($(this).attr("href"));


    });


    /*--------CREATE NOTICE VIEWS CODE END-----------*/






    /*-----------------------------------------------------------------#######   Update Table Notice Data Function Code Start  #######---------------------------------------------------------------------------------*/


    function NoticeDropdown_UpdateNotice_In_View() {
        var InstanceIds = $('#Instance_STxt').val();
        var InstanceIdSS = $('#InstanceIdTXT').val();

        $.ajax({
            type: "GET",
            url: "@Url.Action("NoticeTypedd", "Admin")",
            data: { InstanceId: InstanceIdSS },
            success: function (data) {
                $.each(data, function (index, item) {
                    $("#ENoticeTypeId_UTXT").append($('<option>', {
                        value: item.value,
                        text: item.text
                    }));
                });
            },
            error: function (error) {
                console.error("Error fetching data:", error);
            }
        });
    }

    function ENoticeedit(ENoticeId) {
        debugger;
        $('#UpdateErrorMessage').text('');
        $('#UpdatevalidationMessage').text('');
        $('#Updatevalidation').text('');

        NoticeDropdown_UpdateNotice_In_View();
        $('#ManagenoticeMaindiv').hide();
        $('#Home_SearchNotices_Updatediv').show();
        $('#ErrorMessage').text("");



        $.ajax({
            url: "/Admin/Edit_ENotices_ById",
            data: { ENoticeId: ENoticeId },
            type: "GET",
            success: function (response) {


                debugger;

                $("#InstanceId_UTXT").val(response[0].instanceId);
                $("#CreatedBy_UTXT").val(response[0].createdBy);
                $("#ENoticeId_UTXT").val(response[0].eNoticeId);

                var eNoticeTypeId = response[0].eNoticeTypeId;

                $('#ENoticeTypeId_UTXT option').each(function () {
                    var ENoticeTypeValue=$(this).val();

                    if (parseInt(ENoticeTypeValue) === parseInt(eNoticeTypeId)) {
                        $(this).prop("selected", true);
                    }
                    else {
                        $(this).prop("Selected",false);
                    }
                });
                $("#Subject_UTXT").val(response[0].subject);
                $("#ENoticeDescription_UTXT").val(response[0].eNoticeDescription);



                var originalstartDate = response[0].startDate;
                var startdateParts = originalstartDate.split(' ')[0].split('-');
                var formattedstartDate = startdateParts[2] + '-' + startdateParts[1] + '-' + startdateParts[0];

                document.getElementById("StartDate_UTXT").value = formattedstartDate;

                var originalendtDate = response[0].expiryDate;
                var enddateParts = originalendtDate.split(' ')[0].split('-');
                var formattedendDate = enddateParts[2] + '-' + enddateParts[1] + '-' + enddateParts[0];

                document.getElementById("EndDate_UTXT").value = formattedendDate;

                var FileName = response[0].noticeDocument;

                var characterCount = FileName.length;
                if (characterCount > 0) {
                    $("#currentFileName").text(FileName);
                    $("#NoticeDocument_UTxtFile").hide();
                    $("#deleteFileBtn").show();
                    debugger;
                    $("#NoticeDocument_UTxtFile").on("change click", function () {
                        debugger;
                        var fileName = $(this).val().split("\\").pop() || "";
                        $("#currentFileName").text(fileName);
                    });

                    $("#currentFileName").on("click", function () {
                        debugger;
                        $("#NoticeDocument_UTxtFile").click();
                    });
                }
                else {
                    $("#NoticeDocument_UTxtFile").show();
                    $("#currentFileName").text('');
                    $("#deleteFileBtn").hide();
                }

                //$('#Noticetabledata_div').html(response);
            }
        });

    }

    $("#deleteFileBtn").on("click", function () {

        $('#UpdateErrorMessage').text('');
        $('#UpdatevalidationMessage').text('');
        $('#Updatevalidation').text('');

        $("#currentFileName").text(" ");
        $("#NoticeDocument_UTxtFile").val("");
        $("#deleteFileBtn").hide();
        $("#NoticeDocument_UTxtFile").show();
    });


    function DeleteNotice(ENoticeId) {
        debugger;
        $.ajax({
            url: "/Admin/Delete_ENotices_ById",
            data: { ENoticeId: ENoticeId },
            type: "GET",
            success: function (response) {
                managenotice_tabledata();
                $('#ErrorMessage').text("Record deleted successfully.");
            }
        });
    }


  


  

   

    /*----------- NOTICE DATA FUNCTION UPDATING CODE IS END -----------*/

    /*----------- DELETE NOTICE TYPE IN UPDATE SCREEN THIS METHOD CODE IS START -----------*/

    $('#DeleteNotice_UpBtn').click(function () {
        debugger;
        $('#ManagenoticeMaindiv').show();
        $('#Home_SearchNotices_Updatediv').hide();

        var ENoticeId = $('#ENoticeId_UTXT').val();
        DeleteNotice(ENoticeId);

    });

    /*----------- DELETE NOTICE TYPE IN UPDATE SCREEN THIS METHOD CODE IS END -----------*/


    /*-----------------------------------------------------------------####### Update Table Notice Data Function Code End #######---------------------------------------------------------------------------------*/


</script>